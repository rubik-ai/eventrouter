version: "3"

services:
  app:
    image: golang:1.12.9
    volumes:
      - ../../:/src/
    working_dir: /src/
    command: ["go", "run", "tests/kafka_confluent/main.go"]
    links:
      - kafka
    environment:
      KAFKA_AVRO_BROKERS: 192.168.1.6:9092
      KAFKA_AVRO_TOPIC: eventrouter
      KAFKA_AVRO_RETRYMAX: 5
      KAFKA_AVRO_ASYNC: "true"
    depends_on:
      - "kafka"

  zookeeper:
   image: wurstmeister/zookeeper
   ports:
     - "2181:2181"
  kafka:
   image: wurstmeister/kafka
   depends_on:
     - zookeeper
   ports:
     - "9092:9092"
   environment:
     KAFKA_ADVERTISED_PORT: 9092
     KAFKA_ADVERTISED_HOST_NAME: kafka
     KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
   volumes:
     - /var/run/docker.sock:/var/run/docker.sock

  registry:
   image: confluentinc/cp-schema-registry:5.3.0
   depends_on:
     - kafka
   ports:
     - "8089:8081"
   environment:
     SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: kafka:9092
     SCHEMA_REGISTRY_HOST_NAME: schema-registry

  